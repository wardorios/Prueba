<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Obra - Vivienda Unifamiliar</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>Monitor de Avance de Obra</h1>
                <div class="obra-info">
                    <h2>Vivienda Unifamiliar - Abel Rios y Alba Velazquez</h2>
                    <p>üìç Condominio Costa Del Lago - Hernandarias</p>
                    <p>üìÖ √öltimo Certificado: N¬∞ <span id="cert-numero">05</span> - <span id="cert-fecha">29/12/2025</span></p>
                </div>
            </div>
            <div class="header-branding">
                <p class="logo-text">engenhaBIM</p>
                <p style="font-size: 0.8rem; color: var(--gray-dark);">Proyectos e Treinamentos</p>
            </div>
        </header>

        <!-- Dashboard Principal con Gauges -->
        <section class="dashboard">
            <div class="card card-progreso">
                <h3>Progreso General</h3>
                <div class="gauge-container" id="gauge-progreso">
                    <!-- Se generar√° con JavaScript -->
                </div>
            </div>

            <div class="card card-ejecutado">
                <h3>Total Ejecutado</h3>
                <p class="big-number">‚Ç≤ <span id="total-ejecutado">237.666.280</span></p>
                <p style="font-size: 0.9rem; color: var(--gray-dark); margin-top: 10px;">
                    de ‚Ç≤ <span id="presupuesto-total">1.040.000.000</span>
                </p>
            </div>

            <div class="card card-pendiente">
                <h3>Velocidad de Obra</h3>
                <div class="gauge-container" id="gauge-velocidad">
                    <!-- Se generar√° con JavaScript -->
                </div>
            </div>

            <div class="card card-progreso">
                <h3>Eficiencia Presupuestaria</h3>
                <div class="gauge-container" id="gauge-eficiencia">
                    <!-- Se generar√° con JavaScript -->
                </div>
            </div>
        </section>

        <!-- Evoluci√≥n Temporal -->
        <section class="grafico-section">
            <div class="card">
                <h3>Evoluci√≥n Temporal de la Obra</h3>
                <div id="timeline-mes-mes" class="timeline-container">
                    <!-- Se generar√° con JavaScript -->
                </div>
            </div>
        </section>

        <!-- Comparaci√≥n Proyecto vs Entregado por Rubro -->
        <section class="grafico-section">
            <div class="card">
                <h3>Comparaci√≥n: Proyectado vs Ejecutado</h3>
                <div id="chart-comparacion" class="chart-container">
                    <!-- Se generar√° con JavaScript -->
                </div>
            </div>
        </section>

        <!-- Gr√°fico de Progreso por Rubro -->
        <section class="grafico-section">
            <div class="card">
                <h3>Progreso por Rubro Principal</h3>
                <div id="chart-rubros" class="chart-container"></div>
            </div>
        </section>

        <!-- Filtros y Controles -->
        <section class="controles">
            <div class="filtros">
                <button class="btn btn-filter active" onclick="filtrarRubros('todos')">Todos</button>
                <button class="btn btn-filter" onclick="filtrarRubros('completados')">Completados</button>
                <button class="btn btn-filter" onclick="filtrarRubros('en-proceso')">En Proceso</button>
                <button class="btn btn-filter" onclick="filtrarRubros('pendientes')">Pendientes</button>
            </div>
            <div class="acciones">
                <button class="btn btn-primary" onclick="exportarDatos()">üì• Exportar CSV</button>
                <button class="btn btn-secondary" onclick="imprimirReporte()">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- Tabla Detallada de Rubros -->
        <section class="tabla-section">
            <div class="card">
                <h3>üìã Detalle de Rubros y Sub-√≠tems</h3>
                <div class="tabla-container">
                    <table id="tabla-rubros">
                        <thead>
                            <tr>
                                <th>N¬∞</th>
                                <th>Rubro / Sub-√≠tem</th>
                                <th>UND</th>
                                <th>Cantidad Total</th>
                                <th>Cant. Acumulada</th>
                                <th>Precio Unitario</th>
                                <th>Precio Total</th>
                                <th>Monto Ejecutado</th>
                                <th>Progreso</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-body">
                            <!-- Se llenar√° con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Resumen por Certificado -->
        <section class="certificados-section">
            <div class="card">
                <h3>üìÑ Resumen de Certificaciones</h3>
                <div class="certificado-resumen">
                    <div class="cert-item">
                        <span class="cert-label">Monto Anterior:</span>
                        <span class="cert-valor">‚Ç≤ <span id="monto-anterior">199.723.200</span></span>
                    </div>
                    <div class="cert-item">
                        <span class="cert-label">Monto Actual (Cert. 05):</span>
                        <span class="cert-valor highlight">‚Ç≤ <span id="monto-actual">37.943.080</span></span>
                    </div>
                    <div class="cert-item">
                        <span class="cert-label">Monto Acumulado:</span>
                        <span class="cert-valor">‚Ç≤ <span id="monto-acumulado">237.666.280</span></span>
                    </div>
                    <div class="cert-item">
                        <span class="cert-label">Devoluci√≥n Anticipo (20%):</span>
                        <span class="cert-valor negative">- ‚Ç≤ <span id="devolucion-anticipo">47.533.256</span></span>
                    </div>
                    <div class="cert-item total">
                        <span class="cert-label">Total Neto a Pagar:</span>
                        <span class="cert-valor">‚Ç≤ <span id="total-neto">190.133.024</span></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Sistema de Monitoreo de Obra - Melgarejo Celano Arquitectura & Desarrollo</p>
            <p>Arq. Eduardo Melgarejo - Reg. Prof. N¬∞. 2.912</p>
        </footer>
    </div>

    <!-- Bot√≥n Flotante para Cargar Nuevo Certificado -->
    <button class="btn-float" onclick="abrirModalCarga()" title="Cargar Nuevo Certificado">
        +
    </button>

    <!-- Modal de Carga de PDF -->
    <div class="modal-overlay" id="modal-carga">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Cargar Nuevo Certificado</h2>
                <button class="modal-close" onclick="cerrarModalCarga()">&times;</button>
            </div>
            <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
                <div class="upload-icon">üìÑ</div>
                <p class="upload-text">Arrastra tu certificado PDF aqu√≠</p>
                <p class="upload-hint">o haz clic para seleccionar un archivo</p>
                <input type="file" id="file-input" accept=".pdf" onchange="procesarPDF(event)">
            </div>
            <div id="upload-status" style="margin-top: 20px; text-align: center;"></div>
        </div>
    </div>

    <!-- Librer√≠as -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
